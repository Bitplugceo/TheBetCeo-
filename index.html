<!DOCTYPE html>
<html lang="en">
<head>
<link rel="apple-touch-icon" href="0A45F320-A89F-4851-AA4E-CE22138FD52F.jpeg">
<link rel="icon" type="image/jpeg" href="0A45F320-A89F-4851-AA4E-CE22138FD52F.jpeg">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Basketball Prediction Engine</title>

<style>
body { background:#1b1b1b; color:#d4af37; font-family:Segoe UI,sans-serif; margin:0; }
.wrapper { max-width:680px; margin:auto; padding:12px 14px 40px; }
h1 { text-align:center; font-size:18px; margin-bottom:12px; }

.section { border:1px solid #d4af37; background:#202020; padding:8px 10px; margin-bottom:10px; }
.section h2 { font-size:14px; margin-bottom:6px; }

label { display:block; font-size:12px; margin:5px 0 2px; }

input, select {
  width:240px;
  max-width:90%;
  padding:5px 6px;
  font-size:12px;
  background:#262626;
  color:#d4af37;
  border:1px solid #d4af37;
  margin:4px 0 8px 0;
  border-radius:0;
  appearance:none;
  -webkit-appearance:none;
}

input[type="checkbox"] { width:auto; margin-right:6px; }

.buttons { text-align:center; margin-top:10px; }
.btn {
  padding:6px 18px;
  margin:6px;
  font-size:12px;
  font-weight:bold;
  background:#d4af37;
  color:#111;
  border:none;
  cursor:pointer;
}

.table-wrap { overflow-x:auto; margin-top:12px; }

#results {
  width:100%;
  border-collapse:collapse;
  font-size:12px;
  display:none;
}

#results th,#results td {
  border:1px solid #d4af37;
  padding:6px;
  text-align:center;
}

.pred-over { background:#1e7d3a; color:#fff; font-weight:bold; }
.pred-under { background:#8b1e1e; color:#fff; font-weight:bold; }
.pred-noplay { background:#444; color:#bbb; font-weight:bold; }

.lock{
  font-size:4px;
  margin-left:2px;
  display:inline-flex;
  align-items:center;
  transform:translateY(-2px);
}
</style>
</head>

<body>
<div class="wrapper">
<h1>üèÄ Basketball Prediction Engine</h1>

<div class="section">
  <label>Select League</label>
  <select id="league">
    <option value="NBA">NBA</option>
    <option value="NCAA">NCAA</option>
    <option value="EuroLeague">EuroLeague</option>
    <option value="ACB">Spain ACB</option>
    <option value="ABA">Liga ABA</option>
    <option value="Other">Other</option>
  </select>

  <h2>Market Lines</h2>

  <label>FT Total Market (150.5 - 180.5)</label>
  <input id="ftMarket">

  <label>1H Total Market (75.5 - 95.5)</label>
  <input id="h1Market">

  <label>Team A Total Market</label>
  <input id="teamAMarket">

  <label>Team B Total Market</label>
  <input id="teamBMarket">
</div>

<div class="section">
  <h2>Team Scoring</h2>
  <label>Team A Last 5</label>
  <input id="teamAAvg" placeholder="80,70,68,50,75">
  <label>Team B Last 5</label>
  <input id="teamBAvg" placeholder="78,82,74,69,85">
</div>

<div class="section">
  <h2>Head to Head (Optional)</h2>
  <label><input type="checkbox" id="useH2HFT"> Use H2H (FT)</label>
  <input id="h2hA" placeholder="80,75,82">
  <input id="h2hB" placeholder="70,68,74">
</div>

<div class="section">
  <h2>Team A Metrics</h2>
  <label>Team A PAPG</label>
  <input id="papgA">
  <h2>Team B Metrics</h2>
  <label>Team B PAPG</label>
  <input id="papgB">
</div>

<div class="buttons">
  <button class="btn" onclick="runEngine()">Run</button>
  <button class="btn" onclick="clearAll()">Clear</button>
</div>

<div class="table-wrap">
<table id="results"></table>
</div>
</div>

<script>

const PLAYABLE = 75;

/* ---------- Helpers ---------- */

function parseList(id){
  let raw=document.getElementById(id).value;
  if(!raw) return [];
  return raw.split(",").map(x=>parseFloat(x.trim())).filter(x=>!isNaN(x));
}

function stdDev(arr){
  if(arr.length<2) return NaN;
  let mean=arr.reduce((a,b)=>a+b,0)/arr.length;
  let variance=arr.reduce((a,b)=>a+Math.pow(b-mean,2),0)/arr.length;
  return Math.sqrt(variance);
}

function trimmedMean(arr){
  if(arr.length<3){
    return arr.length ? arr.reduce((a,b)=>a+b,0)/arr.length : NaN;
  }
  let sorted=[...arr].sort((a,b)=>a-b);
  sorted.shift();
  sorted.pop();
  return sorted.reduce((a,b)=>a+b,0)/sorted.length;
}

function mid(r){
  if(!r||!r.includes("-")) return NaN;
  let p=r.split("-");
  let a=parseFloat(p[0]);
  let b=parseFloat(p[1]);
  if(isNaN(a)||isNaN(b)) return NaN;
  return (a+b)/2;
}

function confidence(edge,vol){
  if(isNaN(edge)||isNaN(vol)||vol===0) return 0;
  let strength=Math.abs(edge)/(vol*1.2);
  let base=60 + strength*25;
  return Math.min(90,Math.round(base));
}

function generateLines(low,high){
  let arr=[];
  for(let l=low;l<=high;l+=1){
    arr.push(parseFloat(l.toFixed(1)));
  }
  return arr;
}

function selectLine(proj,vol,low,high,isOver){
  if(isNaN(proj)||isNaN(vol)||isNaN(low)||isNaN(high)) return null;
  let lines=generateLines(low,high);

  if(isOver){
    let safe=proj-(vol*0.8);
    let valid=lines.filter(x=>x<=safe);
    return valid.length?Math.max(...valid).toFixed(1):null;
  }else{
    let safe=proj+(vol*0.8);
    let valid=lines.filter(x=>x>=safe);
    return valid.length?Math.min(...valid).toFixed(1):null;
  }
}

/* ---------- Engine ---------- */

function runEngine(){

  let table=document.getElementById("results");
  table.style.display="table";
  table.innerHTML=`
  <tr>
    <th>Pick</th>
    <th>Proj</th>
    <th>Edge</th>
    <th>Prediction</th>
    <th>Conf%</th>
  </tr>`;

  let league=document.getElementById("league").value;
  let leagueVolMultiplier=1.0;

  if(league==="NBA") leagueVolMultiplier=1.1;
  if(league==="NCAA") leagueVolMultiplier=1.15;
  if(league==="EuroLeague") leagueVolMultiplier=0.95;

  let aList=parseList("teamAAvg");
  let bList=parseList("teamBAvg");

  let aMean=trimmedMean(aList);
  let bMean=trimmedMean(bList);

  let aVol=stdDev(aList);
  let bVol=stdDev(bList);

  if(!isNaN(aVol)) aVol*=leagueVolMultiplier;
  if(!isNaN(bVol)) bVol*=leagueVolMultiplier;

  let combinedVol=(!isNaN(aVol)&&!isNaN(bVol))?(aVol+bVol)/2:NaN;

  let papgA=parseFloat(document.getElementById("papgA").value);
  let papgB=parseFloat(document.getElementById("papgB").value);

  if(!isNaN(papgB)&&!isNaN(aMean)){
    aMean=(aMean*0.75)+(papgB*0.25);
  }

  if(!isNaN(papgA)&&!isNaN(bMean)){
    bMean=(bMean*0.75)+(papgA*0.25);
  }

  if(document.getElementById("useH2HFT").checked){
    let h2hA=trimmedMean(parseList("h2hA"));
    let h2hB=trimmedMean(parseList("h2hB"));

    if(!isNaN(h2hA)&&!isNaN(aMean)){
      aMean=(aMean*0.8)+(h2hA*0.2);
    }

    if(!isNaN(h2hB)&&!isNaN(bMean)){
      bMean=(bMean*0.8)+(h2hB*0.2);
    }
  }

  let ftProj=(!isNaN(aMean)&&!isNaN(bMean))?aMean+bMean:NaN;

  let ftMarket=document.getElementById("ftMarket").value;
  let marketMid=mid(ftMarket);

  if(!isNaN(ftProj)&&!isNaN(marketMid)&&!isNaN(combinedVol)){
    let compression=Math.min(0.25,combinedVol/45);
    ftProj=ftProj*(1-compression)+(marketMid*compression);
  }

  let h1Proj=!isNaN(ftProj)?ftProj*0.48:NaN;

  function addRow(name,proj,market,vol,priority){

    let m=mid(market);
    let edge=!isNaN(proj)&&!isNaN(m)?proj-m:NaN;
    let conf=confidence(edge,vol);
    let pred="NO PLAY";

    if(conf>=PLAYABLE && Math.abs(edge)>=4){
      let p=market.split("-");
      let low=parseFloat(p[0]);
      let high=parseFloat(p[1]);
      let line=selectLine(proj,vol,low,high,edge>0);
      if(line){
        pred=(edge>0?"OVER ":"UNDER ")+line;
      }
    }

    let row=table.insertRow();
    row.innerHTML=`
      <td>${name}</td>
      <td>${isNaN(proj)?"NaN":proj.toFixed(1)}</td>
      <td>${isNaN(edge)?"NaN":edge.toFixed(1)}</td>
      <td class="${pred.startsWith("OVER")?"pred-over":pred.startsWith("UNDER")?"pred-under":"pred-noplay"}">${pred}</td>
      <td>${conf}%</td>`;

    return {name,conf,edge,priority,pred};
  }

  let results=[];
  results.push(addRow("FT Total",ftProj,ftMarket,combinedVol,1));
  results.push(addRow("1H Total",h1Proj,document.getElementById("h1Market").value,combinedVol*0.7,3));
  results.push(addRow("Team A Total",aMean,document.getElementById("teamAMarket").value,aVol,2));
  results.push(addRow("Team B Total",bMean,document.getElementById("teamBMarket").value,bVol,2));

  let valid=results.filter(x=>x.conf>=PLAYABLE&&x.pred!=="NO PLAY");

  if(valid.length){
    valid.sort((a,b)=>{
      if(b.conf!==a.conf) return b.conf-a.conf;
      if(Math.abs(b.edge)!==Math.abs(a.edge)) return Math.abs(b.edge)-Math.abs(a.edge);
      return a.priority-b.priority;
    });

    let best=valid[0].name;
    for(let i=1;i<table.rows.length;i++){
      if(table.rows[i].cells[0].innerText===best){
        table.rows[i].cells[3].innerHTML+=" <span class='lock'>üîí</span>";
      }
    }
  }
}

function clearAll(){
  document.querySelectorAll("input").forEach(i=>{
    if(i.type==="checkbox") i.checked=false;
    else i.value="";
  });
  document.getElementById("results").style.display="none";
}

</script>
</body>
</html>
