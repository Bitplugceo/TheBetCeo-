<!DOCTYPE html>
<html lang="en">
<head>
<link rel="apple-touch-icon" href="0A45F320-A89F-4851-AA4E-CE22138FD52F.jpeg">
<link rel="icon" type="image/jpeg" href="0A45F320-A89F-4851-AA4E-CE22138FD52F.jpeg">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Basketball Prediction Engine</title>

<style>
body { background:#1b1b1b; color:#d4af37; font-family:Segoe UI,sans-serif; margin:0; }
.wrapper { max-width:680px; margin:auto; padding:12px 14px 40px; }
h1 { text-align:center; font-size:18px; margin-bottom:12px; }
.section { border:1px solid #d4af37; background:#202020; padding:8px 10px; margin-bottom:10px; }
.section h2 { font-size:14px; margin-bottom:6px; }
label { display:block; font-size:12px; margin:5px 0 2px; }
input { width:240px; max-width:90%; padding:5px 6px; font-size:12px; background:#262626; color:#d4af37; border:1px solid #d4af37; margin:4px 0 8px 0; }
select {
  width:240px;
  max-width:90%;
  padding:5px 6px;
  font-size:12px;
  background:#262626;
  color:#d4af37;
  border:1px solid #d4af37;
  margin:4px 0 8px 0;
  border-radius:0;      /* ‚Üê THIS removes round edges */
  outline:none;
  appearance:none;
  -webkit-appearance:none;
}
input[type="checkbox"] { width:auto; margin-right:6px; }
.buttons { text-align:center; margin-top:10px; }
.btn { padding:6px 18px; margin:6px; font-size:12px; font-weight:bold; background:#d4af37; color:#111; border:none; cursor:pointer; }
.table-wrap { overflow-x:auto; margin-top:12px; }
#results { width:100%; border-collapse:collapse; font-size:12px; display:none; }
#results th,#results td { border:1px solid #d4af37; padding:6px; text-align:center; }
.pred-over { background:#1e7d3a; color:#fff; font-weight:bold; }
.pred-under { background:#8b1e1e; color:#fff; font-weight:bold; }
.pred-noplay { background:#444; color:#bbb; font-weight:bold; }
.lock{
  font-size:4px;
  margin-left:2px;
  display:inline-flex;
  align-items:center;
  transform:translateY(-2px);
}
</style>
</head>

<body>
<div class="wrapper">
<h1>üèÄ Basketball Prediction Engine</h1>
<label>Select League</label>
<select id="league">
  <option value="NBA">NBA</option>
  <option value="NCAA">NCAA</option>
  <option value="EuroLeague">EuroLeague</option>
  <option value="EuroCup">EuroCup</option>
  <option value="VTB">VTB</option>
  <option value="ACB">Spain ACB</option>
  <option value="ABA">Liga ABA</option>
  <option value="Italy">Italy Serie A</option>
  <option value="France">France Pro A</option>
  <option value="Germany">Germany BBL</option>
  <option value="Turkey">Turkey BSL</option>
  <option value="Greece">Greece A1</option>
  <option value="Other">Other</option>
</select>
<div class="section">
<h2>Market Lines</h2>
<label>FT Total Market (150.5 - 180.5)</label>
<input id="ftMarket">
<label>1H Total Market (75.5 - 95.5)</label>
<input id="h1Market">
<label>Team A Total Market</label>
<input id="teamAMarket">
<label>Team B Total Market</label>
<input id="teamBMarket">
</div>
<div class="section">
<h2>Team Scoring</h2>
<label>Team A Last 5</label>
<input id="teamAAvg" placeholder="80,70,68,50,75">
<label>Team B Last 5</label>
<input id="teamBAvg" placeholder="78,82,74,69,85">
</div>

<div class="section">
<h2>Head to Head (Optional)</h2>
<label><input type="checkbox" id="useH2HFT"> Use H2H (FT)</label>
<input id="h2hA" placeholder="80,75,82,78">
<input id="h2hB" placeholder="70,68,74,72">
<label><input type="checkbox" id="useH2H1H"> Use H2H (1H)</label>
<input id="h2h1H" placeholder="75,80,78">
</div>

<div class="section">
<h2>Team A Metrics</h2>
<label>Team A PAPG</label>
<input id="papgA">
<h2>Team B Metrics</h2>
<label>Team B PAPG</label>
<input id="papgB">
</div>

<div class="buttons">
<button class="btn" onclick="runEngine()">Run</button>
<button class="btn" onclick="clearAll()">Clear</button>
</div>

<div class="table-wrap">
<table id="results"></table>
</div>
</div>

<script>

const PLAYABLE = 75;

function parseList(id){
  let raw=document.getElementById(id).value;
  if(!raw) return [];
  return raw.split(",").map(x=>parseFloat(x.trim())).filter(x=>!isNaN(x));
}

function weightedMean(arr){
  let w=[0.30,0.25,0.20,0.15,0.10];
  let sum=0,total=0;
  for(let i=0;i<arr.length&&i<5;i++){
    sum+=arr[i]*w[i];
    total+=w[i];
  }
  return total?sum/total:NaN;
}

function stdDev(arr){
  if(arr.length<2) return NaN;
  let mean=arr.reduce((a,b)=>a+b,0)/arr.length;
  let variance=arr.reduce((a,b)=>a+Math.pow(b-mean,2),0)/arr.length;
  return Math.sqrt(variance);
}

function mid(r){
  if(!r||!r.includes("-")) return NaN;
  let p=r.split("-");
  let a=parseFloat(p[0]);
  let b=parseFloat(p[1]);
  if(isNaN(a)||isNaN(b)) return NaN;
  return (a+b)/2;
}

function confidence(edge,vol){
  if(isNaN(edge)||isNaN(vol)||vol===0) return 0;
  let strength=Math.abs(edge)/vol;
  return Math.min(92,Math.round(60+strength*20));
}

function generateLines(low,high){
  let arr=[];
  for(let l=low;l<=high;l+=1){
    arr.push(parseFloat(l.toFixed(1)));
  }
  return arr;
}

function selectLine(proj,vol,low,high,isOver){
  if(isNaN(proj)||isNaN(vol)||isNaN(low)||isNaN(high)) return null;
  let lines=generateLines(low,high);
  if(isOver){
    let safe=proj-vol;
    let valid=lines.filter(x=>x<=safe);
    return valid.length?Math.max(...valid).toFixed(1):null;
  }else{
    let safe=proj+vol;
    let valid=lines.filter(x=>x>=safe);
    return valid.length?Math.min(...valid).toFixed(1):null;
  }
}

function runEngine(){

  let table=document.getElementById("results");
  table.style.display="table";

  table.innerHTML=`
  <tr>
  <th>Pick</th>
  <th>Proj</th>
  <th>Edge</th>
  <th>Prediction</th>
  <th>Conf%</th>
  </tr>`;

  let aList=parseList("teamAAvg");
  let bList=parseList("teamBAvg");

  let aMean=weightedMean(aList);
  let bMean=weightedMean(bList);

  let aVol=stdDev(aList);
  let bVol=stdDev(bList);
  let combinedVol=(!isNaN(aVol)&&!isNaN(bVol))?(aVol+bVol)/2:NaN;
let league = document.getElementById("league").value;
let volMultiplier = 1.0;

switch(league){
  case "NBA": volMultiplier = 1.15; break;
  case "NCAA": volMultiplier = 1.10; break;
  case "EuroLeague": volMultiplier = 0.95; break;
  case "EuroCup": volMultiplier = 0.97; break;
  case "VTB": volMultiplier = 1.00; break;
  case "ACB": volMultiplier = 1.00; break;
  case "ABA": volMultiplier = 1.00; break;
  case "Italy": volMultiplier = 1.02; break;
  case "France": volMultiplier = 1.03; break;
  case "Germany": volMultiplier = 1.02; break;
  case "Turkey": volMultiplier = 1.03; break;
  case "Greece": volMultiplier = 0.98; break;
  case "Other": volMultiplier = 1.05; break;
}

if(!isNaN(combinedVol)){
  combinedVol *= volMultiplier;
}
if(!isNaN(aVol)){
  aVol *= volMultiplier;
}
if(!isNaN(bVol)){
  bVol *= volMultiplier;
}

  let papgA=parseFloat(document.getElementById("papgA").value);
  let papgB=parseFloat(document.getElementById("papgB").value);

  if(!isNaN(aMean) && !isNaN(papgB)){
    aMean = aMean*0.7 + papgB*0.3;
  }

  if(!isNaN(bMean) && !isNaN(papgA)){
    bMean = bMean*0.7 + papgA*0.3;
  }

  if(document.getElementById("useH2HFT").checked){
    let h2hAList=parseList("h2hA");
    let h2hBList=parseList("h2hB");
    let h2hAMean=weightedMean(h2hAList);
    let h2hBMean=weightedMean(h2hBList);

    if(!isNaN(aMean)&&!isNaN(h2hAMean)){
      aMean = aMean*0.8 + h2hAMean*0.2;
    }

    if(!isNaN(bMean)&&!isNaN(h2hBMean)){
      bMean = bMean*0.8 + h2hBMean*0.2;
    }
  }

  let ftProj=(!isNaN(aMean)&&!isNaN(bMean))?aMean+bMean:NaN;

  let ratio=0.48;

  if(document.getElementById("useH2H1H").checked){
    let h1List=parseList("h2h1H");
    let h1Mean=weightedMean(h1List);
    if(!isNaN(h1Mean)&&!isNaN(ftProj)&&ftProj!==0){
      ratio=h1Mean/ftProj;
    }
  }

  let h1Proj=!isNaN(ftProj)?ftProj*ratio:NaN;

  function addRow(name,proj,market,vol,priority){

    let m=mid(market);
    let edge=!isNaN(proj)&&!isNaN(m)?proj-m:NaN;
    let conf=confidence(edge,vol);
    let pred="NO PLAY";

    if(conf>=PLAYABLE&&!isNaN(edge)){
      let p=market.split("-");
      let low=parseFloat(p[0]);
      let high=parseFloat(p[1]);
      let line=selectLine(proj,vol,low,high,edge>0);
      if(line){
        pred=(edge>0?"OVER ":"UNDER ")+line;
      }else{
        conf=0;
      }
    }

    let row=table.insertRow();
    row.innerHTML=`
    <td>${name}</td>
    <td>${isNaN(proj)?"NaN":proj.toFixed(1)}</td>
    <td>${isNaN(edge)?"NaN":edge.toFixed(1)}</td>
    <td class="${pred.startsWith("OVER")?"pred-over":pred.startsWith("UNDER")?"pred-under":"pred-noplay"}">${pred}</td>
    <td>${conf}%</td>`;

    return {name,conf,edge,priority,pred};
  }

  let results=[];

  results.push(addRow("FT Total",ftProj,document.getElementById("ftMarket").value,combinedVol,1));
  results.push(addRow("1H Total",h1Proj,document.getElementById("h1Market").value,combinedVol*0.6,3));
  results.push(addRow("Team A Total",aMean,document.getElementById("teamAMarket").value,aVol,2));
  results.push(addRow("Team B Total",bMean,document.getElementById("teamBMarket").value,bVol,2));

  let valid=results.filter(x=>x.conf>=PLAYABLE&&x.pred!=="NO PLAY");

  if(valid.length){
    valid.sort((a,b)=>{
      if(b.conf!==a.conf) return b.conf-a.conf;
      if(Math.abs(b.edge)!==Math.abs(a.edge)) return Math.abs(b.edge)-Math.abs(a.edge);
      return a.priority-b.priority;
    });
    let best=valid[0].name;
    for(let i=1;i<table.rows.length;i++){
      if(table.rows[i].cells[0].innerText===best){
        table.rows[i].cells[3].innerHTML+=" <span class='lock'>üîí</span>";
      }
    }
  }
}

function clearAll(){
  document.querySelectorAll("input").forEach(i=>{
    if(i.type==="checkbox") i.checked=false;
    else i.value="";
  });
  document.getElementById("results").style.display="none";
}

</script>
</body>
</html>
