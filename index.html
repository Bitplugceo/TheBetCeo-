<!DOCTYPE html>
<html lang="en">
<head>
<link rel="apple-touch-icon" href="0A45F320-A89F-4851-AA4E-CE22138FD52F.jpeg">
<link rel="icon" type="image/jpeg" href="0A45F320-A89F-4851-AA4E-CE22138FD52F.jpeg">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Basketball Prediction Engine</title>

<style>
body { background:#1b1b1b; color:#d4af37; font-family:Segoe UI,sans-serif; margin:0; }
.wrapper { max-width:680px; margin:auto; padding:12px 14px 40px; }
h1 { text-align:center; font-size:18px; margin-bottom:12px; }
.section { border:1px solid #d4af37; background:#202020; padding:8px 10px; margin-bottom:10px; }
.section h2 { font-size:14px; margin-bottom:6px; }
label { display:block; font-size:12px; margin:5px 0 2px; }
input { width:240px; max-width:90%; padding:5px 6px; font-size:12px; background:#262626; color:#d4af37; border:1px solid #d4af37; margin:4px 0 8px 0; }
input[type="checkbox"] { width:auto; margin-right:6px; }
.metrics { display:block; }
.buttons { text-align:center; margin-top:10px; }
.btn { padding:6px 18px; margin:6px; font-size:12px; font-weight:bold; background:#d4af37; color:#111; border:none; cursor:pointer; }
.table-wrap { overflow-x:auto; margin-top:12px; }
#results { width:100%; border-collapse:collapse; font-size:12px; display:none; }
#results th,#results td { border:1px solid #d4af37; padding:6px; text-align:center; }
.pred-over { background:#1e7d3a; color:#fff; font-weight:bold; }
.pred-under { background:#8b1e1e; color:#fff; font-weight:bold; }
.pred-noplay { background:#444; color:#bbb; font-weight:bold; }

.lock{
  font-size:4px;
  margin-left:2px;
  display:inline-flex;
  align-items:center;
  transform:translateY(-2px);
}

</style>
</head>

<body>
<div class="wrapper">
<h1>üèÄ Basketball Prediction Engine</h1>

<div class="section">
  <h2>Market Lines</h2>
  <label>FT Total Market (150.5 - 160.5)</label>
  <input id="ftMarket">
  <label>1H Total Market (75.5 - 85.5)</label>
  <input id="h1Market">
  <label>Team A Total Market</label>
  <input id="teamAMarket">
  <label>Team B Total Market</label>
  <input id="teamBMarket">
</div>

<div class="section">
  <h2>Team Scoring Averages</h2>
  <label>Team A FT Average</label>
  <input id="teamAAvg">
  <label>Team B FT Average</label>
  <input id="teamBAvg">
</div>

<div class="section">
  <h2>Head to Head (Optional)</h2>
  <label><input type="checkbox" id="useH2HFT"> Use H2H (FT)</label>
  <input id="h2hA" placeholder="Team A H2H FT Avg">
  <input id="h2hB" placeholder="Team B H2H FT Avg">
  <label><input type="checkbox" id="useH2H1H"> Use H2H (1H)</label>
  <input id="h2h1H" placeholder="1H H2H Avg Total">
</div>

<div class="section metrics">
  <h2>Team A Metrics</h2>
  <label>Team A Pace</label>
  <input id="paceA">
  <label>Team A Points Allowed</label>
  <input id="papgA">
  <h2>Team B Metrics</h2>
  <label>Team B Pace</label>
  <input id="paceB">
  <label>Team B Points Allowed</label>
  <input id="papgB">
</div>

<div class="buttons">
  <button class="btn" onclick="runEngine()">Run</button>
  <button class="btn" onclick="clearAll()">Clear</button>
</div>

<div class="table-wrap">
<table id="results">
<tr>
  <th>Pick</th>
  <th>Engine Mid</th>
  <th>Edge</th>
  <th>Prediction</th>
  <th>Confidence %</th>
</tr>
</table>
</div>
</div>

<script>
function num(id){
  let v=parseFloat(document.getElementById(id).value);
  return isNaN(v)?NaN:v;
}

function mid(r){
  if(!r||!r.includes("-"))return NaN;
  let[a,b]=r.split("-").map(x=>parseFloat(x));
  return(isNaN(a)||isNaN(b))?NaN:(a+b)/2;
}

function clamp(v,min,max){
  if(isNaN(min)||isNaN(max))return v;
  return Math.max(min,Math.min(max,v));
}

function confidence(edge, vol){
  if(isNaN(edge)||isNaN(vol)||vol===0)return 0;
  let strength=Math.abs(edge)/(vol*1.1);
  let base=60+(strength*25);
  return Math.min(90,Math.round(base));
}

function runEngine(){

  const table=document.getElementById("results");
  table.style.display="table";
  table.innerHTML=`<tr>
  <th>Pick</th>
  <th>Engine Mid</th>
  <th>Edge</th>
  <th>Prediction</th>
  <th>Confidence %</th>
  </tr>`;

  let ftStr=ftMarket.value,
      h1Str=h1Market.value,
      aStr=teamAMarket.value,
      bStr=teamBMarket.value;

  let ft=mid(ftStr),
      h1=mid(h1Str),
      aM=mid(aStr),
      bM=mid(bStr);

  let [ftL,ftH]=ftStr.split("-").map(x=>parseFloat(x)||NaN);
  let [h1L,h1H]=h1Str.split("-").map(x=>parseFloat(x)||NaN);
  let [aL,aH]=aStr.split("-").map(x=>parseFloat(x)||NaN);
  let [bL,bH]=bStr.split("-").map(x=>parseFloat(x)||NaN);

  let aAvg=num("teamAAvg"),
      bAvg=num("teamBAvg"),
      h2hA=num("h2hA"),
      h2hB=num("h2hB"),
      h2h1H=num("h2h1H"),
      papgA=num("papgA"),
      papgB=num("papgB");

  let useFT=useH2HFT.checked,
      use1H=useH2H1H.checked;

  /* -------- Offensive Blend -------- */

  let aOff = useFT && !isNaN(h2hA)
    ? (0.75*aAvg + 0.25*h2hA)
    : aAvg;

  let bOff = useFT && !isNaN(h2hB)
    ? (0.75*bAvg + 0.25*h2hB)
    : bAvg;

  /* -------- Defensive Blend (Softened) -------- */

  if(!isNaN(papgB) && !isNaN(aOff)){
    aOff = (aOff*0.75) + (papgB*0.25);
  }

  if(!isNaN(papgA) && !isNaN(bOff)){
    bOff = (bOff*0.75) + (papgA*0.25);
  }

  /* -------- Projections -------- */

  let ftEng = (!isNaN(aOff)&&!isNaN(bOff)) ? aOff + bOff : NaN;

  /* Projection Compression Toward Market */

  if(!isNaN(ftEng)&&!isNaN(ft)){
    let volatility = Math.abs(aOff-bOff);
    let compression = Math.min(0.15, volatility/40);
    ftEng = ftEng*(1-compression) + ft*compression;
  }

  let h1Eng = !isNaN(ftEng) ? ftEng*0.48 : NaN;

  if(use1H && !isNaN(h2h1H)){
    h1Eng = (h1Eng*0.75) + (h2h1H*0.25);
  }

  let aEng = aOff;
  let bEng = bOff;

  /* -------- Row Builder -------- */

  function make(name, eng, mkt, low, high){

    let edge = eng - mkt;
    let vol = Math.abs(aOff-bOff);
    let conf = confidence(edge, vol);

    let pred="NO PLAY";

    if(Math.abs(edge)>=4 && conf>=70){

      if(edge>0){
        pred="OVER "+clamp(mkt-3,low,high).toFixed(1);
      }else{
        pred="UNDER "+clamp(mkt+3,low,high).toFixed(1);
      }
    }

    return {
      name,
      eng:isNaN(eng)?"NaN":eng.toFixed(2),
      edge:isNaN(edge)?"NaN":edge.toFixed(2),
      pred,
      conf,
      raw:edge
    };
  }

  let picks=[
    make("FT Total",ftEng,ft,ftL,ftH),
    make("1H Total",h1Eng,h1,h1L,h1H),
    make("Team A Total",aEng,aM,aL,aH),
    make("Team B Total",bEng,bM,bL,bH)
  ];

  /* -------- Lock Logic -------- */

  let lock=-1,max=0;
  picks.forEach((p,i)=>{
    if(Math.abs(p.raw)>max && p.pred!=="NO PLAY"){
      max=Math.abs(p.raw);
      lock=i;
    }
  });

  picks.forEach((p,i)=>{
    let row=table.insertRow();
    let pr=p.pred;
    if(i===lock) pr+=` <span class="lock">üîí</span>`;
    row.innerHTML=`<td>${p.name}</td>
    <td>${p.eng}</td>
    <td>${p.edge}</td>
    <td class="${
      p.pred.startsWith("OVER")?"pred-over":
      p.pred.startsWith("UNDER")?"pred-under":
      "pred-noplay"}">${pr}</td>
    <td>${p.conf}%</td>`;
  });

}

function clearAll(){
  document.querySelectorAll("input").forEach(i=>{
    if(i.type==="checkbox") i.checked=false;
    else i.value="";
  });
  results.style.display="none";
}
</script>
</body>
</html>
