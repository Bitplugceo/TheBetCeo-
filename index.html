<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Basketball Prediction Engine</title>

<style>
body {
  background: #111;
  color: #d4af37;
  font-family: Segoe UI, sans-serif;
  margin: 0;
}

.wrapper {
  max-width: 760px;
  margin: 12px auto;
  padding: 0 10px;
}

h1 {
  text-align: center;
  margin-bottom: 12px;
  font-size: 18px;
}

.section {
  border: 1px solid #d4af37;
  background: #1a1a1a;
  padding: 8px 12px;
  margin: 10px auto;
  width: 92%;
  box-sizing: border-box;
}

.section h2 {
  font-size: 15px;
  margin-bottom: 6px;
}

label {
  display: block;
  font-size: 12px;
  margin-bottom: 3px;
}

input {
  width: 100%;
  max-width: 240px;
  padding: 4px 6px;
  font-size: 12px;
  background: #222;
  color: #d4af37;
  border: 1px solid #d4af37;
  margin-bottom: 6px;
}

input[type="checkbox"] {
  width: auto;
  margin-right: 6px;
}

.buttons {
  text-align: center;
  margin-top: 10px;
}

.btn {
  padding: 5px 14px;
  margin: 5px;
  font-size: 12px;
  font-weight: bold;
  background: #d4af37;
  color: #111;
  border: none;
  cursor: pointer;
}

.table-wrap {
  overflow-x: auto;
  margin-top: 10px;
}

#results {
  width: 92%;
  margin: auto;
  border-collapse: collapse;
  font-size: 12px;
  display: none;
}

#results th, #results td {
  border: 1px solid #d4af37;
  padding: 5px;
  text-align: center;
}

.pred-over { background:#1e7d3a; color:#fff; font-weight:bold; }
.pred-under { background:#8b1e1e; color:#fff; font-weight:bold; }
.pred-noplay { background:#444; color:#bbb; font-weight:bold; }

.lock {
  font-size: 8px;
  display: inline-block;
  vertical-align: middle;
  transform: translateY(-1px);
  margin-left: 4px;
}

/* layout for side-by-side team metrics */
.flex {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}
.half {
  flex: 1 1 48%;
}
</style>
</head>

<body>
<div class="wrapper">

<h1>üèÄ Basketball Prediction Engine</h1>

<div class="section">
  <h2>Market Lines</h2>
  <label>FT Total Market (e.g. 150.5 - 160.5)</label>
  <input id="ftMarket">
  <label>1H Total Market (e.g. 75.5 - 85.5)</label>
  <input id="h1Market">
  <label>Team A Total Market</label>
  <input id="teamAMarket">
  <label>Team B Total Market</label>
  <input id="teamBMarket">
</div>

<div class="section">
  <h2>Team Scoring Averages</h2>
  <label>Team A FT Average</label>
  <input id="teamAAvg">
  <label>Team B FT Average</label>
  <input id="teamBAvg">
</div>

<div class="section">
  <h2>Head to Head (Optional)</h2>
  <label><input type="checkbox" id="useH2HFT"> Use H2H (FT)</label>
  <input id="h2hA" placeholder="Team A H2H FT Avg">
  <input id="h2hB" placeholder="Team B H2H FT Avg">
  <label><input type="checkbox" id="useH2H1H"> Use H2H (1H)</label>
  <input id="h2h1H" placeholder="1H H2H Avg Total">
</div>

<div class="section flex">
  <div class="half">
    <h2>Team A Metrics</h2>
    <label>Team A Pace</label>
    <input id="paceA">
    <label>Team A Points Allowed</label>
    <input id="papgA">
  </div>
  <div class="half">
    <h2>Team B Metrics</h2>
    <label>Team B Pace</label>
    <input id="paceB">
    <label>Team B Points Allowed</label>
    <input id="papgB">
  </div>
</div>

<div class="buttons">
  <button class="btn" onclick="runEngine()">Run</button>
  <button class="btn" onclick="clearAll()">Clear</button>
</div>

<div class="table-wrap">
<table id="results">
<tr>
  <th>Pick</th>
  <th>Engine Mid</th>
  <th>Edge</th>
  <th>Prediction</th>
  <th>Confidence %</th>
</tr>
</table>
</div>

</div>

<script>
function num(id) {
  let v = parseFloat(document.getElementById(id).value);
  return isNaN(v) ? NaN : v;
}

function mid(range) {
  if (!range || !range.includes("-")) return NaN;
  let [a, b] = range.split("-").map(x => parseFloat(x.trim()));
  return (isNaN(a) || isNaN(b)) ? NaN : (a + b) / 2;
}

function clamp(value, min, max) {
  return Math.max(min, Math.min(max, value));
}

function confidence(edge) {
  if (isNaN(edge)) return 0;
  return Math.min(95, Math.round(70 + (Math.abs(edge) - 3) * 5));
}

function runEngine() {
  const table = document.getElementById("results");
  table.style.display = "table";
  table.innerHTML = `
    <tr>
      <th>Pick</th>
      <th>Engine Mid</th>
      <th>Edge</th>
      <th>Prediction</th>
      <th>Confidence %</th>
    </tr>`;

  let ftMarketStr = document.getElementById("ftMarket").value;
  let h1MarketStr = document.getElementById("h1Market").value;
  let aMarketStr = document.getElementById("teamAMarket").value;
  let bMarketStr = document.getElementById("teamBMarket").value;

  let ftMarket = mid(ftMarketStr);
  let h1Market = mid(h1MarketStr);
  let aMarket = mid(aMarketStr);
  let bMarket = mid(bMarketStr);

  function getRange(str) {
    if (!str.includes("-")) return [NaN, NaN];
    let [low, high] = str.split("-").map(x => parseFloat(x.trim()));
    return [low, high];
  }

  let [ftLow, ftHigh] = getRange(ftMarketStr);
  let [h1Low, h1High] = getRange(h1MarketStr);
  let [aLow, aHigh] = getRange(aMarketStr);
  let [bLow, bHigh] = getRange(bMarketStr);

  let aAvg = num("teamAAvg");
  let bAvg = num("teamBAvg");
  let h2hA = num("h2hA");
  let h2hB = num("h2hB");
  let h2h1H = num("h2h1H");
  let papgA = num("papgA");
  let papgB = num("papgB");

  let useH2HFT = document.getElementById("useH2HFT").checked;
  let useH2H1H = document.getElementById("useH2H1H").checked;

  let aOff = useH2HFT ? (0.7 * aAvg + 0.3 * h2hA) : aAvg;
  let bOff = useH2HFT ? (0.7 * bAvg + 0.3 * h2hB) : bAvg;

  let aEngine = (aOff + papgB) / 2;
  let bEngine = (bOff + papgA) / 2;

  let offenseBase = aAvg + bAvg;
  let h2hBase = h2hA + h2hB;
  let ftOff = useH2HFT ? (0.7 * offenseBase + 0.3 * h2hBase) : offenseBase;
  let ftEngine = (ftOff + papgA + papgB) / 2;

  let h1Engine = ftEngine * 0.48;
  if (useH2H1H) h1Engine = (0.7 * h1Engine + 0.3 * h2h1H);

  function makePick(name, engine, market, low, high) {
    let edge = engine - market;
    let conf = confidence(edge);
    let pred = "NO PLAY";

    if (!isNaN(edge)) {
      if (edge > 0) {
        let line = clamp(market - 3, low, high);
        pred = "OVER " + line.toFixed(1);
      } else if (edge < 0) {
        let line = clamp(market + 3, low, high);
        pred = "UNDER " + line.toFixed(1);
      }
    }

    if (conf < 70) pred = "NO PLAY";

    return {
      name,
      engine: isNaN(engine) ? "NaN" : engine.toFixed(2),
      edge: isNaN(edge) ? "NaN" : edge.toFixed(2),
      pred,
      conf,
      rawEdge: edge
    };
  }

  let picks = [
    makePick("FT Total", ftEngine, ftMarket, ftLow, ftHigh),
    makePick("1H Total", h1Engine, h1Market, h1Low, h1High),
    makePick("Team A Total", aEngine, aMarket, aLow, aHigh),
    makePick("Team B Total", bEngine, bMarket, bLow, bHigh)
  ];

  let lockIndex = -1;
  let maxEdge = 0;

  picks.forEach((p, i) => {
    if (!isNaN(p.rawEdge) && Math.abs(p.rawEdge) > maxEdge && p.conf >= 70) {
      maxEdge = Math.abs(p.rawEdge);
      lockIndex = i;
    }
  });

  picks.forEach((p, i) => {
    let row = table.insertRow();
    let predText = p.pred;

    if (i === lockIndex && p.pred !== "NO PLAY") {
      predText += ` <span class="lock">üîí</span>`;
    }

    row.innerHTML = `
      <td>${p.name}</td>
      <td>${p.engine}</td>
      <td>${p.edge}</td>
      <td class="${p.pred.startsWith("OVER") ? "pred-over" :
                   p.pred.startsWith("UNDER") ? "pred-under" : "pred-noplay"}">
        ${predText}
      </td>
      <td>${p.conf}%</td>
    `;
  });
}

function clearAll() {
  document.querySelectorAll("input").forEach(i => {
    if (i.type === "checkbox") i.checked = false;
    else i.value = "";
  });
  document.getElementById("results").style.display = "none";
}
</script>

</body>
</html>
