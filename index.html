<!DOCTYPE html>
<html lang="en">
<head>

<link rel="apple-touch-icon" href="0A45F320-A89F-4851-AA4E-CE22138FD52F.jpeg">
<link rel="icon" type="image/jpeg" href="0A45F320-A89F-4851-AA4E-CE22138FD52F.jpeg">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Basketball Prediction Engine V2</title>

<style>
body { background:#1b1b1b; color:#d4af37; font-family:Segoe UI,sans-serif; margin:0; }
.wrapper { max-width:680px; margin:auto; padding:12px 14px 40px; }
h1 { text-align:center; font-size:18px; margin-bottom:12px; }
.section { border:1px solid #d4af37; background:#202020; padding:8px 10px; margin-bottom:10px; }
.section h2 { font-size:14px; margin-bottom:6px; }
label { display:block; font-size:12px; margin:5px 0 2px; }
input { width:95%; padding:5px; font-size:12px; background:#262626; color:#d4af37; border:1px solid #d4af37; margin-bottom:8px; }
.buttons { text-align:center; margin-top:10px; }
.btn { padding:6px 18px; margin:6px; font-size:12px; font-weight:bold; background:#d4af37; color:#111; border:none; cursor:pointer; }
#results { width:100%; border-collapse:collapse; font-size:12px; margin-top:12px; display:none; }
#results th,#results td { border:1px solid #d4af37; padding:6px; text-align:center; }
.pred-over { background:#1e7d3a; color:#fff; font-weight:bold; }
.pred-under { background:#8b1e1e; color:#fff; font-weight:bold; }
.pred-noplay { background:#444; color:#bbb; font-weight:bold; }
.lock { font-size:10px; margin-left:4px; }
</style>
</head>

<body>
<div class="wrapper">

<h1>üèÄ Basketball Prediction Engine V2</h1>

<div class="section">
<h2>Market Lines</h2>
<label>FT Total (150.5 - 180.5)</label>
<input id="ftMarket">
<label>1H Total (70.5 - 95.5)</label>
<input id="h1Market">
<label>Team A Total</label>
<input id="teamAMarket">
<label>Team B Total</label>
<input id="teamBMarket">
</div>

<div class="section">
<h2>Team A Last 5 (Regulation, most recent first)</h2>
<input id="teamAList" placeholder="80,70,68,50,75">
<h2>Team B Last 5</h2>
<input id="teamBList" placeholder="78,82,74,69,85">
</div>

<div class="section">
<h2>H2H Totals (Optional)</h2>
<input id="h2hList" placeholder="158,162,149">
</div>

<div class="section">
<h2>Defensive Stats</h2>
<label>Team A PAPG</label>
<input id="papgA">
<label>Team B PAPG</label>
<input id="papgB">
</div>

<div class="buttons">
<button class="btn" onclick="runEngine()">Run</button>
<button class="btn" onclick="clearAll()">Clear</button>
</div>

<table id="results"></table>

</div>

<script>
function parseList(id){
  let raw=document.getElementById(id).value;
  if(!raw) return [];
  return raw.split(",").map(x=>parseFloat(x.trim())).filter(x=>!isNaN(x));
}

function weightedMean(arr){
  let weights=[0.30,0.25,0.20,0.15,0.10];
  let sum=0, wsum=0;
  for(let i=0;i<arr.length && i<5;i++){
    sum+=arr[i]*weights[i];
    wsum+=weights[i];
  }
  return sum/wsum;
}

function stdDev(arr){
  if(arr.length<2) return 0;
  let mean=arr.reduce((a,b)=>a+b,0)/arr.length;
  let variance=arr.reduce((a,b)=>a+Math.pow(b-mean,2),0)/arr.length;
  return Math.sqrt(variance);
}

function mid(r){
  if(!r||!r.includes("-")) return NaN;
  let[a,b]=r.split("-").map(x=>parseFloat(x));
  return (a+b)/2;
}

function confidence(edge,vol){
  if(vol===0) return 70;
  let strength=Math.abs(edge)/vol;
  return Math.min(92,Math.round(60 + strength*20));
}

function bestLine(proj,low,high,isOver,vol){
  if(isOver){
    if(proj-low>=vol) return low.toFixed(1);
  } else {
    if(high-proj>=vol) return high.toFixed(1);
  }
  return null;
}

function runEngine(){
  const table=document.getElementById("results");
  table.style.display="table";
  table.innerHTML="<tr><th>Pick</th><th>Proj</th><th>Edge</th><th>Range</th><th>Prediction</th><th>Conf%</th></tr>";

  let aList=parseList("teamAList");
  let bList=parseList("teamBList");
  let h2hList=parseList("h2hList");

  if(aList.length<2||bList.length<2){ alert("Enter valid last 5 scores"); return; }

  let aMean=weightedMean(aList);
  let bMean=weightedMean(bList);

  let aVol=stdDev(aList);
  let bVol=stdDev(bList);

  let combinedVol=(aVol+bVol)/2;

  let papgA=parseFloat(papgA.value)||0;
  let papgB=parseFloat(papgB.value)||0;

  let ftProjection=(aMean + bMean)*0.6 + (papgA + papgB)*0.4;

  if(h2hList.length>0){
    let h2hMean=weightedMean(h2hList);
    ftProjection=ftProjection*0.8 + h2hMean*0.2;
  }

  let ftMarketStr=document.getElementById("ftMarket").value;
  let h1MarketStr=document.getElementById("h1Market").value;
  let aMarketStr=document.getElementById("teamAMarket").value;
  let bMarketStr=document.getElementById("teamBMarket").value;

  let ftMid=mid(ftMarketStr);
  let h1Mid=mid(h1MarketStr);
  let aMid=mid(aMarketStr);
  let bMid=mid(bMarketStr);

  let [ftL,ftH]=ftMarketStr.split("-").map(x=>parseFloat(x));
  let [h1L,h1H]=h1MarketStr.split("-").map(x=>parseFloat(x));
  let [aL,aH]=aMarketStr.split("-").map(x=>parseFloat(x));
  let [bL,bH]=bMarketStr.split("-").map(x=>parseFloat(x));

  let h1Ratio=0.47;
  if(h2hList.length>0){
    h1Ratio=0.48;
  }

  let h1Projection=ftProjection*h1Ratio;

  let picks=[
    {name:"FT Total",proj:ftProjection,mid:ftMid,low:ftL,high:ftH,vol:combinedVol},
    {name:"1H Total",proj:h1Projection,mid:h1Mid,low:h1L,high:h1H,vol:combinedVol*0.6},
    {name:"Team A Total",proj:aMean,mid:aMid,low:aL,high:aH,vol:aVol},
    {name:"Team B Total",proj:bMean,mid:bMid,low:bL,high:bH,vol:bVol}
  ];

  let lockIndex=-1;
  let maxStrength=0;

  picks.forEach((p,i)=>{
    let edge=p.proj - p.mid;
    let isOver=edge>0;
    let line=bestLine(p.proj,p.low,p.high,isOver,p.vol);

    let pred="NO PLAY";
    let conf=0;

    if(line){
      pred=(isOver?"OVER ":"UNDER ")+line;
      conf=confidence(edge,p.vol);
      let strength=Math.abs(edge)/p.vol;
      if(strength>maxStrength){ maxStrength=strength; lockIndex=i; }
    }

    let rangeLow=(p.proj-p.vol).toFixed(1);
    let rangeHigh=(p.proj+p.vol).toFixed(1);

    let row=table.insertRow();
    row.innerHTML=`<td>${p.name}</td>
                   <td>${p.proj.toFixed(1)}</td>
                   <td>${edge.toFixed(1)}</td>
                   <td>${rangeLow}-${rangeHigh}</td>
                   <td class="${pred.startsWith("OVER")?"pred-over":pred.startsWith("UNDER")?"pred-under":"pred-noplay"}">${pred}</td>
                   <td>${conf}%</td>`;
  });

  if(lockIndex>=0){
    table.rows[lockIndex+1].cells[4].innerHTML += ` <span class="lock">üîí</span>`;
  }
}

function clearAll(){
  document.querySelectorAll("input").forEach(i=>i.value="");
  document.getElementById("results").style.display="none";
}
</script>

</body>
</html>
