<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="BB Engine">
<meta name="theme-color" content="#d4af37">

<link rel="manifest" href="manifest.json">

<!-- App Icons -->
<link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">
<link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
<link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">

<title>Basketball Prediction Engine V3</title>

<style>
body{
  background:#111;
  color:#d4af37;
  font-family:Segoe UI,sans-serif;
  margin:0;
}
.wrapper{
  max-width:760px;
  margin:15px auto;
  padding:10px;
}
.section{
  border:1px solid #d4af37;
  background:#1a1a1a;
  padding:10px;
  margin-bottom:12px;
}
input{
  width:100%;
  padding:6px;
  margin-bottom:8px;
  background:#222;
  color:#d4af37;
  border:1px solid #d4af37;
}
button{
  padding:8px 15px;
  background:#d4af37;
  border:none;
  font-weight:bold;
  color:#111;
  cursor:pointer;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th,td{
  border:1px solid #d4af37;
  padding:6px;
  text-align:center;
}
.pred-over{background:#1e7d3a;color:#fff;}
.pred-under{background:#8b1e1e;color:#fff;}
.pred-noplay{background:#444;color:#bbb;}
.god{font-weight:bold;color:#00ffcc;}
</style>
</head>

<body>
<div class="wrapper">

<h2>üèÄ Basketball Prediction Engine V3</h2>

<div class="section">
<label>FT Market (e.g. 150.5 - 160.5)</label>
<input id="ftMarket">

<label>Team A Market</label>
<input id="teamAMarket">

<label>Team B Market</label>
<input id="teamBMarket">
</div>

<div class="section">
<label>Team A Last 5 Scores (comma separated)</label>
<input id="teamAScores">

<label>Team B Last 5 Scores (comma separated)</label>
<input id="teamBScores">

<label>Team A Points Allowed (Last 5 Avg)</label>
<input id="papgA">

<label>Team B Points Allowed (Last 5 Avg)</label>
<input id="papgB">
</div>

<div class="section">
<label>Use H2H (optional)</label>
<input type="checkbox" id="useH2H">

<label>Team A H2H Avg</label>
<input id="h2hA">

<label>Team B H2H Avg</label>
<input id="h2hB">
</div>

<button onclick="runEngine()">Run</button>

<table id="results" style="display:none;">
<tr>
<th>Pick</th>
<th>Projection</th>
<th>Probability</th>
<th>Decision</th>
</tr>
</table>

</div>

<script>
function mid(r){
  if(!r.includes("-")) return NaN;
  let [a,b]=r.split("-").map(x=>parseFloat(x));
  return (a+b)/2;
}

function avg(arr){
  return arr.reduce((a,b)=>a+b,0)/arr.length;
}

function stdDev(arr){
  let mean=avg(arr);
  let variance=arr.reduce((a,b)=>a+Math.pow(b-mean,2),0)/arr.length;
  return Math.sqrt(variance);
}

// Normal CDF approximation
function normalCDF(x){
  return (1.0 + erf(x/Math.sqrt(2))) / 2.0;
}

function erf(x){
  let sign = (x>=0)?1:-1;
  x=Math.abs(x);
  let a1=0.254829592,a2=-0.284496736,a3=1.421413741,
      a4=-1.453152027,a5=1.061405429,p=0.3275911;
  let t=1/(1+p*x);
  let y=1-(((((a5*t+a4)*t)+a3)*t+a2)*t+a1)*t*Math.exp(-x*x);
  return sign*y;
}

function runEngine(){
  let table=document.getElementById("results");
  table.style.display="table";
  table.innerHTML="<tr><th>Pick</th><th>Projection</th><th>Probability</th><th>Decision</th></tr>";

  let ft=mid(document.getElementById("ftMarket").value);
  let aM=mid(document.getElementById("teamAMarket").value);
  let bM=mid(document.getElementById("teamBMarket").value);

  let aScores=document.getElementById("teamAScores").value.split(",").map(x=>parseFloat(x.trim()));
  let bScores=document.getElementById("teamBScores").value.split(",").map(x=>parseFloat(x.trim()));

  let papgA=parseFloat(document.getElementById("papgA").value);
  let papgB=parseFloat(document.getElementById("papgB").value);

  let useH2H=document.getElementById("useH2H").checked;
  let h2hA=parseFloat(document.getElementById("h2hA").value);
  let h2hB=parseFloat(document.getElementById("h2hB").value);

  let aAvg=avg(aScores);
  let bAvg=avg(bScores);

  // 80/20 Blend
  let aOff=useH2H?(0.8*aAvg+0.2*h2hA):aAvg;
  let bOff=useH2H?(0.8*bAvg+0.2*h2hB):bAvg;

  let aProj=0.55*aOff+0.45*papgB;
  let bProj=0.55*bOff+0.45*papgA;
  let ftProj=aProj+bProj;

  function evaluate(name,proj,market,sd){
    if(isNaN(proj)||isNaN(market)) return;
    let z=(proj-market)/sd;
    let prob=normalCDF(z);
    let decision="NO PLAY";
    if(prob>=0.66) decision=prob>=0.70?"GOD MODE":"PLAY";
    let row=table.insertRow();
    row.innerHTML=`<td>${name}</td>
    <td>${proj.toFixed(2)}</td>
    <td>${(prob*100).toFixed(1)}%</td>
    <td class="${decision==="PLAY"?"pred-over":decision==="GOD MODE"?"god":"pred-noplay"}">${decision}</td>`;
  }

  evaluate("FT Total",ftProj,ft,stdDev([...aScores,...bScores]));
  evaluate("Team A",aProj,aM,stdDev(aScores));
  evaluate("Team B",bProj,bM,stdDev(bScores));
}

// Service Worker
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
