<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Basketball Prediction Engine</title>
<style>
body { background:#1b1b1b; color:#d4af37; font-family:Segoe UI,sans-serif; margin:0; }
.wrapper { max-width:680px; margin:auto; padding:12px 14px 40px; }
h1 { text-align:center; font-size:18px; margin-bottom:12px; }
.section { border:1px solid #d4af37; background:#202020; padding:8px 10px; margin-bottom:10px; }
.section h2 { font-size:14px; margin-bottom:6px; }
label { display:block; font-size:12px; margin:5px 0 2px; }
input { width:240px; max-width:90%; padding:5px 6px; font-size:12px; background:#262626; color:#d4af37; border:1px solid #d4af37; margin:4px 0 8px 0; }
input[type="checkbox"] { width:auto; margin-right:6px; }
.metrics { display:block; }
.buttons { text-align:center; margin-top:10px; }
.btn { padding:6px 18px; margin:6px; font-size:12px; font-weight:bold; background:#d4af37; color:#111; border:none; cursor:pointer; }
.table-wrap { overflow-x:auto; margin-top:12px; }
#results { width:100%; border-collapse:collapse; font-size:12px; display:none; }
#results th,#results td { border:1px solid #d4af37; padding:6px; text-align:center; }
.pred-over { background:#1e7d3a; color:#fff; font-weight:bold; }
.pred-under { background:#8b1e1e; color:#fff; font-weight:bold; }
.pred-noplay { background:#444; color:#bbb; font-weight:bold; }
.lock { font-size:4px; margin-left:2px; display:inline-flex; align-items:center; transform:translateY(-2px); }
</style>
</head>
<body>
<div class="wrapper">
<h1>üèÄ Basketball Prediction Engine</h1>

<div class="section">
  <h2>Market Lines</h2>
  <label>FT Total Market</label><input id="ftMarket">
  <label>1H Total Market</label><input id="h1Market">
  <label>Team A Total Market</label><input id="teamAMarket">
  <label>Team B Total Market</label><input id="teamBMarket">
</div>

<div class="section">
  <h2>Team Scoring Averages</h2>
  <label>Team A FT Average</label><input id="teamAAvg">
  <label>Team B FT Average</label><input id="teamBAvg">
</div>

<div class="section">
  <h2>Head to Head (Optional)</h2>
  <label><input type="checkbox" id="useH2HFT"> Use H2H (FT)</label>
  <input id="h2hA" placeholder="Team A H2H FT Avg">
  <input id="h2hB" placeholder="Team B H2H FT Avg">
  <label><input type="checkbox" id="useH2H1H"> Use H2H (1H)</label>
  <input id="h2h1H" placeholder="1H H2H Avg Total">
</div>

<div class="section metrics">
  <h2>Team Metrics</h2>
  <label>Team A PAG</label><input id="pagA">
  <label>Team A PAPG</label><input id="papgA">
  <label>Team A Pace</label><input id="paceA">
  <label>Team B PAG</label><input id="pagB">
  <label>Team B PAPG</label><input id="papgB">
  <label>Team B Pace</label><input id="paceB">
</div>

<div class="buttons">
  <button class="btn" onclick="runEngine()">Run</button>
  <button class="btn" onclick="clearAll()">Clear</button>
</div>

<div class="table-wrap">
<table id="results">
<tr>
  <th>Pick</th>
  <th>Engine Mid</th>
  <th>Edge</th>
  <th>Prediction</th>
  <th>Confidence %</th>
</tr>
</table>
</div>
</div>

<script>
function num(id){let v=parseFloat(document.getElementById(id).value); return isNaN(v)?NaN:v;}
function mid(r){if(!r||!r.includes("-"))return NaN; let [a,b]=r.split("-").map(x=>parseFloat(x)); return (isNaN(a)||isNaN(b))?NaN:(a+b)/2;}
function clamp(v,min,max){return Math.max(min,Math.min(max,v));}
function confidence(e){if(isNaN(e)) return 0; return Math.min(95,Math.round(70 + (Math.abs(e)-3)*5));}

function runEngine(){
  const table = document.getElementById("results");
  table.style.display="table";
  table.innerHTML=`<tr><th>Pick</th><th>Engine Mid</th><th>Edge</th><th>Prediction</th><th>Confidence %</th></tr>`;

  // Markets
  let ftStr=ftMarket.value, h1Str=h1Market.value, aStr=teamAMarket.value, bStr=teamBMarket.value;
  let ft=mid(ftStr), h1=mid(h1Str), aM=mid(aStr), bM=mid(bStr);
  let [ftL,ftH]=ftStr.split("-").map(x=>parseFloat(x)||NaN);
  let [h1L,h1H]=h1Str.split("-").map(x=>parseFloat(x)||NaN);
  let [aL,aH]=aStr.split("-").map(x=>parseFloat(x)||NaN);
  let [bL,bH]=bStr.split("-").map(x=>parseFloat(x)||NaN);

  // Inputs
  let aAvg=num("teamAAvg"), bAvg=num("teamBAvg");
  let h2hA=num("h2hA"), h2hB=num("h2hB"), h2h1H=num("h2h1H");
  let pagA=num("pagA"), pagB=num("pagB"), papgA=num("papgA"), papgB=num("papgB");
  let paceA=num("paceA"), paceB=num("paceB");
  let useFT=useH2HFT.checked, use1H=useH2H1H.checked;

  let picks=[];

  // Team A prediction
  if(aAvg || pagA || papgA || paceA){
    let aOff = useFT?(0.7*aAvg+0.3*h2hA):aAvg;
    let aEng = aOff;
    if(!isNaN(papgB)) aEng += papgB*0.2;
    if(!isNaN(pagB)) aEng += pagB*0.1;
    if(!isNaN(paceB)) aEng += paceB*0.05;
    if(!isNaN(aM)) picks.push(makePick("Team A Total", aEng, aM, aL, aH));
  }

  // Team B prediction
  if(bAvg || pagB || papgB || paceB){
    let bOff = useFT?(0.7*bAvg+0.3*h2hB):bAvg;
    let bEng = bOff;
    if(!isNaN(papgA)) bEng += papgA*0.2;
    if(!isNaN(pagA)) bEng += pagA*0.1;
    if(!isNaN(paceA)) bEng += paceA*0.05;
    if(!isNaN(bM)) picks.push(makePick("Team B Total", bEng, bM, bL, bH));
  }

  // FT Total prediction
  if((aAvg || bAvg) && !isNaN(ft)){
    let ftBase = useFT?(0.65*(aAvg+bAvg)+0.35*(h2hA+h2hB)):(aAvg+bAvg);
    let ftEng = ftBase;
    if(!isNaN(papgA)) ftEng += papgA*0.2;
    if(!isNaN(papgB)) ftEng += papgB*0.2;
    if(!isNaN(pagA)) ftEng += pagA*0.1;
    if(!isNaN(pagB)) ftEng += pagB*0.1;
    if(!isNaN(paceA)) ftEng += paceA*0.05;
    if(!isNaN(paceB)) ftEng += paceB*0.05;
    picks.push(makePick("FT Total", ftEng, ft, ftL, ftH));
  }

  // 1H prediction
  if(!isNaN(h1)){
    let h1Eng = picks.find(p=>p.name==="FT Total")?.engNum*0.47 || h1;
    if(use1H && h2h1H) h1Eng = 0.65*h1Eng + 0.35*h2h1H;
    picks.push(makePick("1H Total", h1Eng, h1, h1L, h1H));
  }

  // Lock calculation
  let lock=-1,max=0;
  picks.forEach((p,i)=>{if(Math.abs(p.edgeNum)>max && p.pred!=="NO PLAY"){max=Math.abs(p.edgeNum);lock=i;}});
  picks.forEach((p,i)=>{
    let row=table.insertRow();
    let pr=p.pred;
    if(i===lock) pr+=` <span class="lock">üîí</span>`;
    row.innerHTML=`<td>${p.name}</td><td>${p.eng}</td><td>${p.edge}</td>
      <td class="${p.pred.startsWith("OVER")?"pred-over":p.pred.startsWith("UNDER")?"pred-under":"pred-noplay"}">${pr}</td>
      <td>${p.conf}%</td>`;
  });

  function makePick(name, eng, mkt, low, high){
    let edge = eng - mkt;
    let conf = confidence(edge);
    let pred = (Math.abs(edge)<4 || conf<70) ? "NO PLAY" : (edge>0 ? "OVER "+clamp(mkt-3,low,high).toFixed(1) : "UNDER "+clamp(mkt+3,low,high).toFixed(1));
    return {name, eng:eng.toFixed(2), engNum:eng, edge:edge.toFixed(2), edgeNum:edge, pred, conf};
  }
}

function clearAll(){
  document.querySelectorAll("input").forEach(i=>{if(i.type==="checkbox") i.checked=false; else i.value="";});
  results.style.display="none";
}
</script>
</body>
</html>
