<!DOCTYPE html>
<html lang="en">
<head>
<link rel="apple-touch-icon" href="0A45F320-A89F-4851-AA4E-CE22138FD52F.jpeg">
<link rel="icon" type="image/jpeg" href="0A45F320-A89F-4851-AA4E-CE22138FD52F.jpeg">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Basketball Prediction Engine</title>

<style>
body { background:#1b1b1b; color:#d4af37; font-family:Segoe UI,sans-serif; margin:0; }
.wrapper { max-width:680px; margin:auto; padding:12px 14px 40px; }
h1 { text-align:center; font-size:18px; margin-bottom:12px; }
.section { border:1px solid #d4af37; background:#202020; padding:8px 10px; margin-bottom:10px; }
.section h2 { font-size:14px; margin-bottom:6px; }
label { display:block; font-size:12px; margin:5px 0 2px; }
input { width:240px; max-width:90%; padding:5px 6px; font-size:12px; background:#262626; color:#d4af37; border:1px solid #d4af37; margin:4px 0 8px 0; }
input[type="checkbox"] { width:auto; margin-right:6px; }
.metrics { display:block; }
.buttons { text-align:center; margin-top:10px; }
.btn { padding:6px 18px; margin:6px; font-size:12px; font-weight:bold; background:#d4af37; color:#111; border:none; cursor:pointer; }
.table-wrap { overflow-x:auto; margin-top:12px; }
#results { width:100%; border-collapse:collapse; font-size:12px; display:none; }
#results th,#results td { border:1px solid #d4af37; padding:6px; text-align:center; }
.pred-over { background:#1e7d3a; color:#fff; font-weight:bold; }
.pred-under { background:#8b1e1e; color:#fff; font-weight:bold; }
.pred-noplay { background:#444; color:#bbb; font-weight:bold; }
.lock{ font-size:4px; margin-left:2px; display:inline-flex; align-items:center; transform:translateY(-2px); }
</style>
</head>

<body>
<div class="wrapper">
<h1>üèÄ Basketball Prediction Engine</h1>

<div class="section">
  <h2>Market Lines</h2>
  <label>FT Total Market (150.5 - 180.5)</label>
  <input id="ftMarket">
  <label>1H Total Market (75.5 - 95.5)</label>
  <input id="h1Market">
  <label>Team A Total Market</label>
  <input id="teamAMarket">
  <label>Team B Total Market</label>
  <input id="teamBMarket">
</div>

<div class="section">
  <h2>Team Scoring</h2>
  <label>Team A Last 5</label>
  <input id="teamAAvg" placeholder="80,70,68,50,75">
  <label>Team B Last 5</label>
  <input id="teamBAvg" placeholder="78,82,74,69,85">
</div>

<div class="section">
  <h2>Head to Head (Optional)</h2>
  <label><input type="checkbox" id="useH2HFT"> Use H2H (FT)</label>
  <input id="h2hA" placeholder="Team A H2H FT Avg">
  <input id="h2hB" placeholder="Team B H2H FT Avg">
  <label><input type="checkbox" id="useH2H1H"> Use H2H (1H)</label>
  <input id="h2h1H" placeholder="1H H2H Avg Total">
</div>

<div class="section metrics">
  <h2>Team A Metrics</h2>
  <label>Team A PAPG</label>
  <input id="papgA">
  <h2>Team B Metrics</h2>
  <label>Team B PAPG</label>
  <input id="papgB">
</div>

<div class="buttons">
  <button class="btn" onclick="runEngine()">Run</button>
  <button class="btn" onclick="clearAll()">Clear</button>
</div>

<div class="table-wrap">
<table id="results"></table>
</div>
</div>

<script>

const PLAYABLE_THRESHOLD = 75;

function parseList(id){
  let raw=document.getElementById(id).value;
  if(!raw) return [];
  return raw.split(",").map(x=>parseFloat(x.trim())).filter(x=>!isNaN(x));
}

function weightedMean(arr){
  let weights=[0.30,0.25,0.20,0.15,0.10];
  let sum=0,wsum=0;
  for(let i=0;i<arr.length && i<5;i++){
    sum+=arr[i]*weights[i];
    wsum+=weights[i];
  }
  return wsum?sum/wsum:NaN;
}

function stdDev(arr){
  if(arr.length<2) return NaN;
  let mean=arr.reduce((a,b)=>a+b,0)/arr.length;
  let variance=arr.reduce((a,b)=>a+Math.pow(b-mean,2),0)/arr.length;
  return Math.sqrt(variance);
}

function mid(r){
  if(!r||!r.includes("-"))return NaN;
  let[a,b]=r.split("-").map(x=>parseFloat(x));
  return (a+b)/2;
}

function confidence(edge,vol){
  if(!vol||isNaN(vol)) return 0;
  let strength=Math.abs(edge)/vol;
  return Math.min(92,Math.round(60 + strength*20));
}

function generateLines(low,high){
  let lines=[];
  for(let l=low;l<=high;l+=1){
    lines.push(parseFloat(l.toFixed(1)));
  }
  return lines;
}

function selectLine(proj,vol,low,high,isOver){
  if(isNaN(proj)||isNaN(vol)||isNaN(low)||isNaN(high)) return null;
  let lines=generateLines(low,high);

  if(isOver){
    let safe=proj-vol;
    let valid=lines.filter(l=>l<=safe);
    if(valid.length===0) return null;
    return Math.max(...valid).toFixed(1);
  } else {
    let safe=proj+vol;
    let valid=lines.filter(l=>l>=safe);
    if(valid.length===0) return null;
    return Math.min(...valid).toFixed(1);
  }
}

function runEngine(){
  const table=document.getElementById("results");
  table.style.display="table";
  table.innerHTML=`<tr>
  <th>Pick</th>
  <th>Proj</th>
  <th>Range</th>
  <th>Edge</th>
  <th>Prediction</th>
  <th>Conf%</th>
  </tr>`;

  let aList=parseList("teamAAvg");
  let bList=parseList("teamBAvg");

  let aMean=weightedMean(aList);
  let bMean=weightedMean(bList);
  let aVol=stdDev(aList);
  let bVol=stdDev(bList);

  let papgA=parseFloat(papgA.value)||0;
  let papgB=parseFloat(papgB.value)||0;

  if(!isNaN(aMean)) aMean=aMean*0.7 + papgB*0.3;
  if(!isNaN(bMean)) bMean=bMean*0.7 + papgA*0.3;

  if(useH2HFT.checked){
    let h2hA=parseFloat(h2hA.value)||0;
    let h2hB=parseFloat(h2hB.value)||0;
    if(!isNaN(aMean)) aMean=aMean*0.8 + h2hA*0.2;
    if(!isNaN(bMean)) bMean=bMean*0.8 + h2hB*0.2;
  }

  let ftProj = (!isNaN(aMean)&&!isNaN(bMean))?aMean+bMean:NaN;
  let combinedVol = (!isNaN(aVol)&&!isNaN(bVol))?(aVol+bVol)/2:NaN;

  let h1Ratio=0.48;
  if(useH2H1H.checked){
    let h2h1H=parseFloat(h2h1H.value);
    if(!isNaN(h2h1H)&&!isNaN(ftProj)){
      h1Ratio=h2h1H/ftProj;
    }
  }
  let h1Proj=!isNaN(ftProj)?ftProj*h1Ratio:NaN;

  function evaluate(name,proj,mktStr,vol,priority){
    let mkt=mid(mktStr);
    let edge=!isNaN(proj)&&!isNaN(mkt)?proj-mkt:NaN;
    let conf=confidence(edge,vol);
    let pred="NO PLAY";

    let line=null;
    if(conf>=PLAYABLE_THRESHOLD && !isNaN(edge)){
      let [low,high]=mktStr.split("-").map(x=>parseFloat(x));
      line=selectLine(proj,vol,low,high,edge>0);
      if(line){
        pred=(edge>0?"OVER ":"UNDER ")+line;
      } else {
        conf=0;
      }
    }

    let rangeLow=!isNaN(proj)&&!isNaN(vol)?(proj-vol).toFixed(1):"NaN";
    let rangeHigh=!isNaN(proj)&&!isNaN(vol)?(proj+vol).toFixed(1):"NaN";

    let row=table.insertRow();
    row.innerHTML=`<td>${name}</td>
    <td>${isNaN(proj)?"NaN":proj.toFixed(1)}</td>
    <td>${rangeLow}-${rangeHigh}</td>
    <td>${isNaN(edge)?"NaN":edge.toFixed(1)}</td>
    <td class="${pred.startsWith("OVER")?"pred-over":pred.startsWith("UNDER")?"pred-under":"pred-noplay"}">${pred}</td>
    <td>${conf}%</td>`;

    return {conf:conf,edge:edge,name:name,priority:priority,pred:pred};
  }

  let results=[];
  results.push(evaluate("FT Total",ftProj,ftMarket.value,combinedVol,1));
  results.push(evaluate("Team A Total",aMean,teamAMarket.value,aVol,2));
  results.push(evaluate("Team B Total",bMean,teamBMarket.value,bVol,2));
  results.push(evaluate("1H Total",h1Proj,h1Market.value,combinedVol*0.6,3));

  let valid=results.filter(r=>r.conf>=PLAYABLE_THRESHOLD && r.pred!=="NO PLAY");

  if(valid.length>0){
    valid.sort((a,b)=>{
      if(b.conf!==a.conf) return b.conf-a.conf;
      if(Math.abs(b.edge)!==Math.abs(a.edge)) return Math.abs(b.edge)-Math.abs(a.edge);
      return a.priority-b.priority;
    });
    let lockName=valid[0].name;
    for(let i=1;i<table.rows.length;i++){
      if(table.rows[i].cells[0].innerText===lockName){
        table.rows[i].cells[4].innerHTML+=" <span class='lock'>üîí</span>";
        break;
      }
    }
  }
}

function clearAll(){
  document.querySelectorAll("input").forEach(i=>{
    if(i.type==="checkbox") i.checked=false;
    else i.value="";
  });
  document.getElementById("results").style.display="none";
}

</script>
</body>
</html>
