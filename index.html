<!DOCTYPE html>
<html lang="en">
<head>

<link rel="apple-touch-icon" href="0A45F320-A89F-4851-AA4E-CE22138FD52F.jpeg">
<link rel="icon" type="image/jpeg" href="0A45F320-A89F-4851-AA4E-CE22138FD52F.jpeg">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

<title>Basketball Prediction Engine</title>

<style>
body { background:#1b1b1b; color:#d4af37; font-family:Segoe UI,sans-serif; margin:0; }
.wrapper { max-width:680px; margin:auto; padding:12px 14px 40px; }
h1 { text-align:center; font-size:18px; margin-bottom:12px; }
.section { border:1px solid #d4af37; background:#202020; padding:8px 10px; margin-bottom:10px; }
.section h2 { font-size:14px; margin-bottom:6px; }
label { display:block; font-size:12px; margin:5px 0 2px; }
input, select { width:240px; max-width:90%; padding:5px 6px; font-size:12px; background:#262626; color:#d4af37; border:1px solid #d4af37; margin:4px 0 8px 0; }
.buttons { text-align:center; margin-top:10px; }
.btn { padding:6px 18px; margin:6px; font-size:12px; font-weight:bold; background:#d4af37; color:#111; border:none; cursor:pointer; }
.table-wrap { overflow-x:auto; margin-top:12px; }
#results { width:100%; border-collapse:collapse; font-size:12px; display:none; }
#results th,#results td { border:1px solid #d4af37; padding:6px; text-align:center; }
.pred-over { background:#1e7d3a; color:#fff; font-weight:bold; }
.pred-under { background:#8b1e1e; color:#fff; font-weight:bold; }
.pred-noplay { background:#444; color:#bbb; font-weight:bold; }
.lock{ font-size:4px; margin-left:2px; display:inline-flex; align-items:center; transform:translateY(-2px); }
</style>
</head>

<body>
<div class="wrapper">
<h1>üèÄ Basketball Prediction Engine</h1>

<div class="section">
<h2>League</h2>
<select id="league">
<option>NBA</option>
<option>NCAA Division I</option>
<option>EuroLeague</option>
<option>EuroCup</option>
<option>ACB Spain</option>
<option>NBL Australia</option>
<option>CBA China</option>
<option>B.League Japan</option>
<option>KBL Korea</option>
<option>PBA Philippines</option>
</select>
</div>

<div class="section">
<h2>Market Lines</h2>
<label>FT Total Market (150.5 - 160.5)</label>
<input id="ftMarket">
</div>

<div class="section">
<h2>Team A</h2>
<input id="aPPG" placeholder="PPG">
<input id="aPAPG" placeholder="PAPG">
<input id="aPace" placeholder="Pace (optional)">
<input id="aOffR" placeholder="OffR (optional)">
<input id="aDefR" placeholder="DefR (optional)">
</div>

<div class="section">
<h2>Team B</h2>
<input id="bPPG" placeholder="PPG">
<input id="bPAPG" placeholder="PAPG">
<input id="bPace" placeholder="Pace (optional)">
<input id="bOffR" placeholder="OffR (optional)">
<input id="bDefR" placeholder="DefR (optional)">
</div>

<div class="buttons">
<button class="btn" onclick="runEngine()">Run</button>
<button class="btn" onclick="clearAll()">Clear</button>
</div>

<div class="table-wrap">
<table id="results">
<tr>
<th>Pick</th>
<th>Engine Mid</th>
<th>Edge</th>
<th>Prediction</th>
<th>Confidence %</th>
</tr>
</table>
</div>

</div>

<script>

/* League SD settings */
const leagueSD = {
  "NBA":13,
  "NCAA Division I":11,
  "EuroLeague":10,
  "EuroCup":10,
  "ACB Spain":10,
  "NBL Australia":11,
  "CBA China":12,
  "B.League Japan":11,
  "KBL Korea":11,
  "PBA Philippines":11
};

function num(id){
  let v=parseFloat(document.getElementById(id).value);
  return isNaN(v)?NaN:v;
}

function mid(r){
  if(!r||!r.includes("-"))return NaN;
  let[a,b]=r.split("-").map(Number);
  return (a+b)/2;
}

function normalCDF(x){
  return (1+erf(x/Math.sqrt(2)))/2;
}

function erf(x){
  let sign=x>=0?1:-1;
  x=Math.abs(x);
  let a1=0.254829592,a2=-0.284496736,a3=1.421413741,
      a4=-1.453152027,a5=1.061405429,p=0.3275911;
  let t=1/(1+p*x);
  let y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-x*x);
  return sign*y;
}

function runEngine(){

  const table=document.getElementById("results");
  table.style.display="table";
  table.innerHTML=`<tr>
  <th>Pick</th>
  <th>Engine Mid</th>
  <th>Edge</th>
  <th>Prediction</th>
  <th>Confidence %</th>
  </tr>`;

  let ftStr=document.getElementById("ftMarket").value;
  let ft=mid(ftStr);

  let sd=leagueSD[document.getElementById("league").value];

  let aPPG=num("aPPG"), aPAPG=num("aPAPG"), aPace=num("aPace"),
      aOffR=num("aOffR"), aDefR=num("aDefR");

  let bPPG=num("bPPG"), bPAPG=num("bPAPG"), bPace=num("bPace"),
      bOffR=num("bOffR"), bDefR=num("bDefR");

  let proj;

  /* Tier 1 */
  if(!isNaN(aOffR)&&!isNaN(aDefR)&&!isNaN(bOffR)&&!isNaN(bDefR)&&!isNaN(aPace)&&!isNaN(bPace)){
    let poss=(aPace+bPace)/2;
    let aPPP=(aOffR/100+bDefR/100)/2;
    let bPPP=(bOffR/100+aDefR/100)/2;
    proj=(aPPP*poss)+(bPPP*poss);
  }

  /* Tier 2 */
  else if(!isNaN(aPace)&&!isNaN(bPace)&&!isNaN(aPPG)&&!isNaN(aPAPG)&&!isNaN(bPPG)&&!isNaN(bPAPG)){
    let poss=(aPace+bPace)/2;
    let aPPP=((aPPG/aPace)+(bPAPG/bPace))/2;
    let bPPP=((bPPG/bPace)+(aPAPG/aPace))/2;
    proj=(aPPP*poss)+(bPPP*poss);
  }

  /* Tier 3 */
  else{
    let aProj=(aPPG+bPAPG)/2;
    let bProj=(bPPG+aPAPG)/2;
    proj=aProj+bProj;
  }

  let edge=proj-ft;
  let z=edge/sd;
  let prob=edge>0?normalCDF(z):1-normalCDF(z);
  let confidence=Math.round(prob*100);

  let pred="NO PLAY";
  if(confidence>=60){
    pred=edge>0?"OVER":"UNDER";
  }

  let row=table.insertRow();
  row.innerHTML=`
  <td>FT Total</td>
  <td>${proj.toFixed(2)}</td>
  <td>${edge.toFixed(2)}</td>
  <td class="${
    pred==="OVER"?"pred-over":
    pred==="UNDER"?"pred-under":
    "pred-noplay"}">${pred}</td>
  <td>${confidence}%</td>`;
}

function clearAll(){
  document.querySelectorAll("input").forEach(i=>i.value="");
  results.style.display="none";
}

</script>
</body>
</html>
