<!DOCTYPE html>
<html lang="en">
<head>
<link rel="apple-touch-icon" href="0A45F320-A89F-4851-AA4E-CE22138FD52F.jpeg">
<link rel="icon" type="image/jpeg" href="0A45F320-A89F-4851-AA4E-CE22138FD52F.jpeg">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Basketball Prediction Engine</title>

<style>
body{
  background:#111;
  color:#d4af37;
  font-family:Segoe UI;
  margin:0;
}
.wrapper{
  max-width:680px;
  margin:auto;
  padding:14px;
}
h1{
  text-align:center;
  margin-bottom:18px;
}
.section{
  border:1px solid #d4af37;
  padding:12px;
  margin-bottom:14px;
}
.section h2{
  margin-bottom:10px;
}
label{
  display:block;
  margin:6px 0 4px;
}
input, select{
  width:240px;
  max-width:95%;
  padding:6px;
  background:#1a1a1a;
  color:#d4af37;
  border:1px solid #d4af37;
  margin-bottom:10px;
}
input[type="checkbox"]{
  width:auto;
  margin-right:6px;
}
.buttons{
  text-align:center;
  margin-top:12px;
}
.btn{
  padding:7px 18px;
  margin:6px;
  background:#d4af37;
  border:none;
  font-weight:bold;
  cursor:pointer;
}
#results{
  width:100%;
  border-collapse:collapse;
  margin-top:16px;
  display:none;
}
#results th,#results td{
  border:1px solid #d4af37;
  padding:6px;
  text-align:center;
}
.pred-over{background:#1e7d3a;color:#fff;font-weight:bold;}
.pred-under{background:#8b1e1e;color:#fff;font-weight:bold;}
.pred-noplay{background:#444;color:#bbb;font-weight:bold;}
.lock{
  font-size:10px;
  margin-left:4px;
}
</style>
</head>

<body>
<div class="wrapper">

<h1>üèÄ Basketball Prediction Engine</h1>

<div class="section">
  <h2>Market Lines</h2>

  <label>Select League</label>
  <select id="league">
    <option>NBA</option>
    <option>NCAA</option>
    <option>EuroLeague</option>
    <option>EuroCup</option>
    <option>VTB</option>
    <option>Spain ACB</option>
    <option>Liga ABA</option>
    <option>Italy Serie A</option>
    <option>France Pro A</option>
    <option>Germany BBL</option>
    <option>Turkey BSL</option>
    <option>Greece A1</option>
    <option>Argentina LNB</option>
    <option>Other</option>
  </select>

  <label>FT Total Market (150.5 - 180.5)</label>
  <input id="ftMarket">

  <label>1H Total Market (75.5 - 95.5)</label>
  <input id="h1Market">

  <label>Team A Total Market</label>
  <input id="teamAMarket">

  <label>Team B Total Market</label>
  <input id="teamBMarket">
</div>

<div class="section">
  <h2>Team Scoring</h2>

  <label>Team A Last 5</label>
  <input id="teamAAvg" placeholder="80,75,82,70,77">

  <label>Team B Last 5</label>
  <input id="teamBAvg" placeholder="78,81,74,85,69">
</div>

<div class="section">
  <h2>Head to Head (Optional)</h2>

  <label>
    <input type="checkbox" id="useH2HFT"> Use H2H (FT)
  </label>
  <input id="h2hA" placeholder="Team A H2H FT (80,75,82)">
  <input id="h2hB" placeholder="Team B H2H FT (70,68,74)">

  <label>
    <input type="checkbox" id="useH2H1H"> Use H2H (1H)
  </label>
  <input id="h2h1H" placeholder="1H H2H Totals (75,80,78)">
</div>

<div class="section">
  <h2>Defensive Stats</h2>

  <label>Team A PAPG</label>
  <input id="papgA">

  <label>Team B PAPG</label>
  <input id="papgB">
</div>

<div class="buttons">
  <button class="btn" onclick="runEngine()">Run</button>
  <button class="btn" onclick="clearAll()">Clear</button>
</div>

<table id="results">
<tr>
<th>Pick</th>
<th>Proj</th>
<th>Edge</th>
<th>Prediction</th>
<th>Conf%</th>
</tr>
</table>

</div>

<script>

const PLAYABLE = 75;

function parseList(id){
  let raw=document.getElementById(id).value;
  if(!raw) return [];
  return raw.split(",")
  .map(x=>parseFloat(x.trim()))
  .filter(x=>!isNaN(x));
}

function weightedMean(arr){
  let w=[0.30,0.25,0.20,0.15,0.10];
  let sum=0,total=0;
  for(let i=0;i<arr.length && i<5;i++){
    sum+=arr[i]*w[i];
    total+=w[i];
  }
  return total?sum/total:NaN;
}

function stdDev(arr){
  if(arr.length<2) return NaN;
  let mean=arr.reduce((a,b)=>a+b,0)/arr.length;
  let variance=arr.reduce((a,b)=>a+Math.pow(b-mean,2),0)/arr.length;
  return Math.sqrt(variance);
}

function mid(r){
  if(!r||!r.includes("-")) return NaN;
  let p=r.split("-");
  let a=parseFloat(p[0]);
  let b=parseFloat(p[1]);
  if(isNaN(a)||isNaN(b)) return NaN;
  return (a+b)/2;
}

function confidence(edge,vol){
  if(isNaN(edge)||isNaN(vol)||vol===0) return 0;
  let strength=Math.abs(edge)/(vol*1.1);
  let base=60+strength*25;
  return Math.min(90,Math.round(base));
}

function generateLines(low,high){
  let arr=[];
  for(let l=low;l<=high;l+=1){
    arr.push(parseFloat(l.toFixed(1)));
  }
  return arr;
}

function selectLine(proj,vol,low,high,isOver){
  if(isNaN(proj)||isNaN(vol)) return null;
  let lines=generateLines(low,high);
  if(isOver){
    let safe=proj-(vol*0.7);
    let valid=lines.filter(x=>x<=safe);
    return valid.length?Math.max(...valid).toFixed(1):null;
  }else{
    let safe=proj+(vol*0.7);
    let valid=lines.filter(x=>x>=safe);
    return valid.length?Math.min(...valid).toFixed(1):null;
  }
}

function runEngine(){

  let table=document.getElementById("results");
  table.style.display="table";
  table.innerHTML=`<tr>
  <th>Pick</th>
  <th>Proj</th>
  <th>Edge</th>
  <th>Prediction</th>
  <th>Conf%</th>
  </tr>`;

  let aList=parseList("teamAAvg");
  let bList=parseList("teamBAvg");

  let aMean=weightedMean(aList);
  let bMean=weightedMean(bList);

  let aVol=stdDev(aList);
  let bVol=stdDev(bList);
  let combinedVol=(aVol+bVol)/2;

  let papgA=parseFloat(document.getElementById("papgA").value);
  let papgB=parseFloat(document.getElementById("papgB").value);

  if(!isNaN(papgB)) aMean=(aMean*0.75)+(papgB*0.25);
  if(!isNaN(papgA)) bMean=(bMean*0.75)+(papgA*0.25);

  if(document.getElementById("useH2HFT").checked){
    let h2hA=weightedMean(parseList("h2hA"));
    let h2hB=weightedMean(parseList("h2hB"));
    if(!isNaN(h2hA)) aMean=(aMean*0.8)+(h2hA*0.2);
    if(!isNaN(h2hB)) bMean=(bMean*0.8)+(h2hB*0.2);
  }

  let ftProj=aMean+bMean;
  let h1Proj=ftProj*0.48;

  if(document.getElementById("useH2H1H").checked){
    let h2h1H=weightedMean(parseList("h2h1H"));
    if(!isNaN(h2h1H)) h1Proj=(h1Proj*0.8)+(h2h1H*0.2);
  }

  function addRow(name,proj,market,vol){
    let m=mid(market);
    let edge=proj-m;
    let conf=confidence(edge,vol);
    let pred="NO PLAY";

    if(conf>=PLAYABLE && Math.abs(edge)>=4){
      let p=market.split("-");
      let low=parseFloat(p[0]);
      let high=parseFloat(p[1]);
      let line=selectLine(proj,vol,low,high,edge>0);
      if(line) pred=(edge>0?"OVER ":"UNDER ")+line;
    }

    let row=table.insertRow();
    row.innerHTML=`<td>${name}</td>
    <td>${proj.toFixed(1)}</td>
    <td>${edge.toFixed(1)}</td>
    <td class="${pred.startsWith("OVER")?"pred-over":pred.startsWith("UNDER")?"pred-under":"pred-noplay"}">${pred}</td>
    <td>${conf}%</td>`;

    return {name,conf,edge,pred};
  }

  let results=[];
  results.push(addRow("FT Total",ftProj,ftMarket.value,combinedVol));
  results.push(addRow("1H Total",h1Proj,h1Market.value,combinedVol*0.7));
  results.push(addRow("Team A Total",aMean,teamAMarket.value,aVol));
  results.push(addRow("Team B Total",bMean,teamBMarket.value,bVol));

  let valid=results.filter(x=>x.conf>=PLAYABLE && x.pred!=="NO PLAY");
  if(valid.length){
    valid.sort((a,b)=>b.conf-a.conf);
    let best=valid[0].name;
    for(let i=1;i<table.rows.length;i++){
      if(table.rows[i].cells[0].innerText===best){
        table.rows[i].cells[3].innerHTML+=" <span class='lock'>üîí</span>";
      }
    }
  }
}

function clearAll(){
  document.querySelectorAll("input").forEach(i=>{
    if(i.type==="checkbox") i.checked=false;
    else i.value="";
  });
  document.getElementById("results").style.display="none";
}

</script>

</body>
</html>
